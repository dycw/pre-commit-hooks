#!/usr/bin/env bash
target="$(git rev-parse --show-toplevel)/.git/hooks/pre-commit"

if [ -d "$target" ]; then
	printf "ERROR: did not expect a directory at:\n    %s\n" "$target"
	exit 1
elif [ -e "$target" ]; then
	printf "Pre-commit hook already installed at:\n    %s\n" "$target"
	if [[ "$1" == --yes ]]; then
		install=1
	else
		read -n1 -p "Overwrite? (y/n): " -r ans
		printf "\n"
		if [[ "$ans" == "y" ]]; then
			printf "Re-installing pre-commit hooks at:\n    %s\n" "$target"
			rm "$target"
			install=0
		else
			install=1
		fi
	fi
else
	printf "Installing pre-commit hooks at:\n    %s\n" "$target"
	install=0
fi

if [ $install -eq 0 ]; then
	here=$(dirname "$(readlink -f "$0")")
	source="$here/pre-commit"
	cp "$source" "$target"
fi
